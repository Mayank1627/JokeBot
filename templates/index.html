<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JokeGPT - AI Comedy Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        #chat-container::-webkit-scrollbar {
            width: 8px;
        }
        #chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #chat-container::-webkit-scrollbar-thumb {
            background: #818cf8;
            border-radius: 10px;
        }
        .typing-indicator {
            display: inline-block;
            padding: 10px 15px;
            background: #eef2ff;
            border-radius: 18px;
        }
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6366f1;
            margin-right: 4px;
            animation: typingAnimation 1.4s infinite both;
        }
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        .user-message {
            background: #4f46e5;
            color: white;
            border-radius: 18px 18px 4px 18px;
            max-width: 80%;
        }
        .bot-message {
            background: #e0e7ff;
            color: #1e293b;
            border-radius: 18px 18px 18px 4px;
            max-width: 80%;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col">
    <header class="bg-indigo-600 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-extrabold tracking-tight">JOKEGPT</h1>
            <div class="flex items-center space-x-2 bg-indigo-700 px-3 py-1 rounded-full">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-sm font-medium">Online</span>
            </div>
        </div>
    </header>

    <main class="flex-1 container mx-auto p-4 overflow-hidden flex flex-col max-w-3xl">
        <div id="chat-container" class="flex-1 overflow-y-auto mb-4 space-y-3">
            <!-- Messages will appear here -->
        </div>

        <div class="bg-white rounded-xl shadow-md p-4">
            <form id="chat-form" class="flex space-x-2">
                <input type="text" id="user-input" 
                    class="flex-1 border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Ask for a joke about..." autocomplete="off">
                <button type="submit" 
                    class="bg-indigo-600 text-white px-5 py-3 rounded-xl hover:bg-indigo-700 transition-colors font-medium">
                    Send
                </button>
            </form>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const chatContainer = document.getElementById('chat-container');

            // Add initial bot message
            setTimeout(() => {
                addMessage("Hey there! I'm JokeGPT. Ask me for any kind of joke - dad jokes, puns, or witty humor!", false);
            }, 800);

            const addMessage = (text, isUser) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
                
                const bubble = document.createElement('div');
                bubble.className = `px-4 py-3 ${isUser ? 'user-message' : 'bot-message'} animate__animated ${
                    isUser ? 'animate__fadeInRight' : 'animate__fadeInLeft'
                }`;
                bubble.textContent = text;
                
                messageDiv.appendChild(bubble);
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            };

            const showTyping = () => {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'flex justify-start';
                
                const bubble = document.createElement('div');
                bubble.className = 'typing-indicator animate__animated animate__fadeInLeft';
                bubble.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                
                typingDiv.appendChild(bubble);
                chatContainer.appendChild(typingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return typingDiv;
            };

            document.addEventListener('DOMContentLoaded', () => {
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const chatContainer = document.getElementById('chat-container');

    // Add this function (place it near the top with other helper functions)
    function ensureJokeResponse(text) {
        const seriousKeywords = ['sorry', 'cannot', "don't know", "can't", "information"];
        if (seriousKeywords.some(word => text.toLowerCase().includes(word))) {
            const fallbackJokes = [
                "Why don't scientists trust atoms? Because they make up everything!",
                "I told my wife she was drawing her eyebrows too high. She looked surprised.",
                "What do you call a fake noodle? An impasta!"
            ];
            return fallbackJokes[Math.floor(Math.random() * fallbackJokes.length)];
        }
        return text;
    }

    // Modify the existing fetch handler (look for your form submit event)
    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        addMessage(message, true);
        userInput.value = '';

        try {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message })
            });

            const data = await response.json();
            
            // Replace this line:
            // addMessage(data.response, false);
            // With these lines:
            const jokeResponse = ensureJokeResponse(data.response);
            addMessage(jokeResponse, false);
            
        } catch (error) {
            addMessage("Failed to connect to the chatbot server", false);
        }
    });

    // ... rest of your existing code ...
});

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = userInput.value.trim();
                if (!message) return;

                addMessage(message, true);
                userInput.value = '';
                
                const typing = showTyping();

                try {
                    const response = await fetch('/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message })
                    });

                    const data = await response.json();
                    
                    // Remove typing indicator
                    typing.remove();
                    
                    if (data.error) {
                        addMessage(`Error: ${data.error}`, false);
                    } else {
                        addMessage(data.response, false);
                    }
                } catch (error) {
                    typing.remove();
                    addMessage("Sorry, I'm having trouble connecting. Try again later!", false);
                }
            });

            // Submit on Enter (but allow Shift+Enter for new lines)
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    chatForm.dispatchEvent(new Event('submit'));
                }
            });
        });
    </script>
</body>
</html>